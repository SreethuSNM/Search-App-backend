(()=>{var e={};e.id=202,e.ids=[202],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6426:(e,t,r)=>{"use strict";r.d(t,{DM:()=>o});let n=Symbol.for("__cloudflare-context__");function o(e={async:!1}){return e.async?i():function(){let e=s();if(e)return e;if(function(){let e=globalThis;return e.__NEXT_DATA__?.nextExport===!0}())throw Error("\n\nERROR: `getCloudflareContext` has been called in sync mode in either a static route or at the top level of a non-static one, both cases are not allowed but can be solved by either:\n  - make sure that the call is not at the top level and that the route is not static\n  - call `getCloudflareContext({async: true})` to use the `async` mode\n  - avoid calling `getCloudflareContext` in the route\n");throw Error(l)}()}function s(){return globalThis[n]}async function i(){let e=s();if(e)return e;{let e=await a();return function(e){globalThis[n]=e}(e),e}}async function a(){let{getPlatformProxy:e}=await import(`${"__wrangler".replaceAll("_","")}`),{env:t,cf:r,ctx:n}=await e({environment:process.env.NEXT_DEV_WRANGLER_ENV});return{env:t,cf:r,ctx:n}}let l='\n\nERROR: `getCloudflareContext` has been called without having called `initOpenNextCloudflareForDev` from the Next.js config file.\nYou should update your Next.js config file as shown below:\n\n   ```\n   // next.config.mjs\n\n   import { initOpenNextCloudflareForDev } from "@opennextjs/cloudflare";\n\n   initOpenNextCloudflareForDev();\n\n'+"   const nextConfig = { ... };\n   export default nextConfig;\n   ```\n\n"},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43021:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>N,routeModule:()=>x,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>g,OPTIONS:()=>p});var o=r(96559),s=r(48088),i=r(37719),a=r(32190),l=r(22563),u=r(97130);function c(e){return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),e}async function p(){return c(new a.NextResponse(null,{status:204}))}function d(e){if("object"==typeof e&&null!==e&&"text"in e){let t=e.text;return"string"==typeof t||"object"==typeof t&&null!==t&&"string"==typeof t.text}return!1}async function f(e,t){let r=(await e.pages.list(t)).pages??[];if(!Array.isArray(r))throw Error("Pages should be an array.");let n={};return r.forEach(e=>{let t=e.title||e.slug,r=e.publishedPath||"";t&&(n[e.id]={title:t,publishedPath:r})}),{pages:r,pageTitleMap:n}}async function h(e,t,r){let n=((await e.pages.getContent(t,{})).nodes||[]).filter(d).map(e=>"string"==typeof e.text?e.text.trim():e.text?.text?.trim()??"").filter(Boolean).join("\n");return{pageId:t,title:r.title,publishedPath:r.publishedPath,text:n}}async function g(e){try{let{searchParams:t}=new URL(e.url),r=t.get("query"),n=t.get("siteName"),o=t.get("collections"),s=t.get("fields");if(!r)return c(a.NextResponse.json({error:"Search query is required"},{status:400}));if(!n)return c(a.NextResponse.json({error:"siteName is required"},{status:400}));let i=r.toLowerCase().trim(),p=[];if(o)try{p=JSON.parse(o)}catch{console.warn("Invalid collections param, ignoring")}let d=[];if(s)try{d=JSON.parse(s)}catch{console.warn("Invalid fields param, ignoring")}let g=await (0,u.A)(n);if(!g)return c(a.NextResponse.json({error:"Invalid site name or no site details found"},{status:404}));let{siteId:x,accessToken:m}=g,w=new l.WebflowClient({accessToken:m}),{pages:y,pageTitleMap:N}=await f(w,x),C=(await Promise.all(y.map(async e=>{try{return await h(w,e.id,N[e.id])}catch(t){return console.error(`Failed to index page ${e.id}`,t),null}}))).filter(Boolean).filter(e=>e.text.toLowerCase().includes(i.toLowerCase())).map(e=>({type:"page",pageId:e.pageId,title:e.title,publishedPath:e.publishedPath,matchedText:function(e,t,r=30){let n=t.toLowerCase(),o=e.toLowerCase().indexOf(n);if(-1===o)return e.slice(0,5*r)+"...";let s=Math.max(0,o-r),i=Math.min(e.length,o+t.length+r),a=e.slice(s,i),l=RegExp(`(${t})`,"ig");return(s>0?"...":"")+a.replace(l,"<mark>$1</mark>")+(i<e.length?"...":"")}(e.text,i)})),v=await w.collections.list(x);if(!v?.collections?.length)return c(a.NextResponse.json({error:"No collections found"},{status:404}));let A=p.length>0?v.collections.filter(e=>p.includes(e.id)):v.collections,O=[];for(let e of A){let t=e.id,r=await w.collections.items.listItems(t);if(r?.items?.length)for(let e of r.items){let r=e.fieldData??e,n=Object.entries(r);if(n.map(([,e])=>String(e).toLowerCase()).some(e=>e.includes(i))){let e={_collectionId:t};for(let[t,r]of d.length>0?n.filter(([e])=>d.includes(e)):n)e[t]="string"==typeof r?function(e,t){if(!t)return e;let r=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),n=RegExp(`(${r})`,"gi");return e.replace(n,"<mark>$1</mark>")}(r,i):r;O.push(e)}}}return c(a.NextResponse.json({query:i,siteId:x,results:{pages:C,cms:O}}))}catch(e){return console.error("Search error:",e),c(a.NextResponse.json({error:"Internal server error"},{status:500}))}}let x=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"D:\\SearchApp\\search-server\\app\\api\\search\\route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:w,serverHooks:y}=x;function N(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:w})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},96487:()=>{},97130:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(6426);async function o(e){try{console.log("sitenme:",e);let{env:t}=await (0,n.DM)({async:!0});if(!t?.WEBFLOW_AUTHENTICATION)return console.error("KV binding WEBFLOW_AUTHENTICATION missing in findSiteDetails"),null;let r=`site-name:${e}`,o=await t.WEBFLOW_AUTHENTICATION.get(r);if(o){let n=await t.WEBFLOW_AUTHENTICATION.get(o);if(n)try{let t=JSON.parse(n);if(t.siteName===e||t.fullDomainName===e)return{...t,siteId:o}}catch(e){return console.error(`Failed to parse SiteDetails JSON for siteId '${o}' (obtained from key '${r}'). Value: ${n}`,e),null}}return console.warn(`findSiteDetails: No site found for siteNameInput '${e}' using direct lookup.`),null}catch(t){return console.error("Error in findSiteDetails for input ",e,t),null}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[297,190,563],()=>r(43021));module.exports=n})();