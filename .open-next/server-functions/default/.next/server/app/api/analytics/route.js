(()=>{var e={};e.id=70,e.ids=[70],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8898:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});var a=r(87806),o=r(21187),n=r(16263),s=r(92120),c=r(4208);let i=async(e,t,r,a)=>{let o=await (0,c.A)(e,t,"verify");(0,s.A)(e,o);let i=(0,n.A)(e,o.algorithm);try{return await crypto.subtle.verify(i,o,r,a)}catch{return!1}};var l=r(70803),d=r(97989),p=r(74996),g=r(89531),y=r(44032),u=r(41286);let h=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};var f=r(95548);async function w(e,t,r){let a,n;if(!(0,g.A)(e))throw new l.Ye("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new l.Ye('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new l.Ye("JWS Protected Header incorrect type");if(void 0===e.payload)throw new l.Ye("JWS Payload missing");if("string"!=typeof e.signature)throw new l.Ye("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,g.A)(e.header))throw new l.Ye("JWS Unprotected Header incorrect type");let s={};if(e.protected)try{let t=(0,o.D)(e.protected);s=JSON.parse(d.D0.decode(t))}catch{throw new l.Ye("JWS Protected Header is invalid")}if(!(0,p.A)(s,e.header))throw new l.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let c={...s,...e.header},w=(0,u.A)(l.Ye,new Map([["b64",!0]]),r?.crit,s,c),m=!0;if(w.has("b64")&&"boolean"!=typeof(m=s.b64))throw new l.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:A}=c;if("string"!=typeof A||!A)throw new l.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');let T=r&&h("algorithms",r.algorithms);if(T&&!T.has(A))throw new l.Rb('"alg" (Algorithm) Header Parameter value not allowed');if(m){if("string"!=typeof e.payload)throw new l.Ye("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new l.Ye("JWS Payload must be a string or an Uint8Array instance");let k=!1;"function"==typeof t&&(t=await t(s,e),k=!0),(0,y.A)(A,t,"verify");let v=(0,d.xW)(d.Rd.encode(e.protected??""),d.Rd.encode("."),"string"==typeof e.payload?d.Rd.encode(e.payload):e.payload);try{a=(0,o.D)(e.signature)}catch{throw new l.Ye("Failed to base64url decode the signature")}let S=await (0,f.A)(t,A);if(!await i(A,S,a,v))throw new l.h2;if(m)try{n=(0,o.D)(e.payload)}catch{throw new l.Ye("Failed to base64url decode the payload")}else n="string"==typeof e.payload?d.Rd.encode(e.payload):e.payload;let b={payload:n};return(void 0!==e.protected&&(b.protectedHeader=s),void 0!==e.header&&(b.unprotectedHeader=e.header),k)?{...b,key:S}:b}async function m(e,t,r){if(e instanceof Uint8Array&&(e=d.D0.decode(e)),"string"!=typeof e)throw new l.Ye("Compact JWS must be a string or Uint8Array");let{0:a,1:o,2:n,length:s}=e.split(".");if(3!==s)throw new l.Ye("Invalid Compact JWS");let c=await w({payload:o,protected:a,signature:n},t,r),i={payload:c.payload,protectedHeader:c.protectedHeader};return"function"==typeof t?{...i,key:c.key}:i}var A=r(91492);async function T(e,t,r){let a=await m(e,t,r);if(a.protectedHeader.crit?.includes("b64")&&!1===a.protectedHeader.b64)throw new l.Dp("JWTs MUST NOT use unencoded payload");let o={payload:(0,A.k)(a.protectedHeader,a.payload,r),protectedHeader:a.protectedHeader};return"function"==typeof t?{...o,key:a.key}:o}var k=r(6426);let v={createSessionToken:async e=>{let t=new TextEncoder().encode(process.env.CLIENT_SECRET),r=await new a.P({user:e}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(t),o=await T(r,t);return console.log("____inside create session_____ ",r),{sessionToken:r,exp:o.payload.exp}},verifyAuth:async e=>{let t=e.headers.get("authorization");console.log("authheader",t);let r=t?.split(" ")[1];if(console.log("session token",r),console.log("inside verify auth session",r),!r)return null;try{let e=new TextEncoder().encode(process.env.CLIENT_SECRET),{payload:t}=await T(r,e),a=t.user.id,{env:o}=await (0,k.DM)({async:!0}),n=await o.WEBFLOW_AUTHENTICATION.get(`user-auth:${a}`);if(n){let e=JSON.parse(n);return console.log("inside verify auth access token",e.accessToken),e.accessToken}return null}catch{return null}},getAccessToken:async e=>{try{let t=null;if("POST"===e.method?(t=(await e.json()).siteId,console.log("siteId",t)):"GET"===e.method&&(t=e.nextUrl.searchParams.get("siteId"),console.log("siteId in params",t)),!t)return console.error("No siteId provided in request."),null;let{env:r}=await (0,k.DM)({async:!0}),a=await r.WEBFLOW_AUTHENTICATION.get(t);if(console.log("stored info in kv",a),a)return JSON.parse(a).accessToken;return console.error(`No access token found for site ${t}`),null}catch(e){return console.error("Error getting access token:",e),null}},getSiteIdFromAccessToken:async e=>{try{let{env:t}=await (0,k.DM)({async:!0});for(let r of(await t.WEBFLOW_AUTHENTICATION.list()).keys){let a=await t.WEBFLOW_AUTHENTICATION.get(r.name);if(a&&JSON.parse(a).accessToken===e)return String(r.name)}return null}catch(e){return console.error("Error getting site ID:",e),null}}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},62008:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>f,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>g,OPTIONS:()=>p});var o=r(96559),n=r(48088),s=r(37719),c=r(32190),i=r(6426),l=r(8898);function d(e){return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),e}async function p(){return d(new c.NextResponse(null,{status:204}))}async function g(e){try{let t;let r=await l.A.verifyAuth(e);if(!r)return d(c.NextResponse.json({error:"Unauthorized"},{status:401}));let a=await l.A.getSiteIdFromAccessToken(r);if(!a)return d(c.NextResponse.json({error:"Unauthorized",details:"SiteId not found"},{status:401}));let{env:o}=await (0,i.DM)({async:!0}),n=await o.WEBFLOW_AUTHENTICATION.get(a);if(!n)return d(c.NextResponse.json({success:!1,error:"Unauthorized - No stored auth"},{status:401}));let s=JSON.parse(n),p=`https://${s.siteName}.webflow.io`;if(!p||!a)return d(c.NextResponse.json({success:!1,error:"Missing siteUrl"},{status:400}));let g=await fetch(p);if(!g.ok)throw Error(`Failed to fetch site content: ${g.statusText}`);let y=(await g.text()).match(/<head[^>]*>([\s\S]*?)<\/head>/i);if(!y)throw Error("No head section found");let u=y[1];console.log("head content",u);let h=[{pattern:/googletagmanager\.com\/gtag\/js\?id=G-[\w-]+/,category:"google-analytics"},{pattern:/google-analytics\.com/,category:"google-analytics"},{pattern:/googletagmanager\.com\/gtag\/js\?id=AW-[\w-]+/,category:"google-ads"},{pattern:/googleadservices\.com/,category:"google-ads"},{pattern:/doubleclick\.net/,category:"google-ads"},{pattern:/gtag\(['"]config['"],\s*['"]AW-[\w-]+['"]\)/,category:"google-ads"},{pattern:/googletagmanager\.com/,category:"google"},{pattern:/google-analytics\.com/,category:"google"},{pattern:/googleadservices\.com/,category:"google"},{pattern:/doubleclick\.net/,category:"google"},{pattern:/google\.com\/ads/,category:"google"},{pattern:/google\.com\/tagmanager/,category:"google"},{pattern:/_gtag/,category:"google"},{pattern:/hotjar\.com/,category:"hotjar"},{pattern:/hotjar\.com/,category:"hotjar"},{pattern:/static\.hj\.contentsquare\.net/,category:"hotjar"},{pattern:/c\._hjSettings/,category:"hotjar"},{pattern:/hj\s*=\s*c\.hj/,category:"hotjar"},{pattern:/hj\.q/,category:"hotjar"},{pattern:/_hjSettings/,category:"hotjar"},{pattern:/\(function\s*\([^)]*\)\s*{\s*c\.hj\s*=/,category:"hotjar"},{pattern:/function\s*\(\s*h\s*,\s*o\s*,\s*t\s*,\s*j\s*,\s*a\s*,\s*r\s*\)/,category:"hotjar"},{pattern:/connect\.facebook\.net/,category:"facebook"},{pattern:/fbevents\.js/,category:"facebook"},{pattern:/graph\.facebook\.com/,category:"facebook"},{pattern:/business\.facebook\.com/,category:"facebook"},{pattern:/clarity\.ms/,category:"clarity"},{pattern:/mouseflow\.com/,category:"mouseflow"},{pattern:/fullstory/,category:"fullstory"},{pattern:/logrocket/,category:"logrocket"},{pattern:/mixpanel/,category:"mixpanel"},{pattern:/segment/,category:"segment"},{pattern:/amplitude/,category:"amplitude"},{pattern:/heap/,category:"heap"},{pattern:/kissmetrics/,category:"kissmetrics"},{pattern:/matomo/,category:"matomo"},{pattern:/piwik/,category:"piwik"},{pattern:/woopra/,category:"woopra"},{pattern:/crazyegg/,category:"crazyegg"},{pattern:/clicktale/,category:"clicktale"},{pattern:/optimizely/,category:"optimizely"},{pattern:/plausible/,category:"plausible"},{pattern:/hs-scripts\.com/,category:"hubspot"}],f=[],w=/<script[^>]*>([\s\S]*?)<\/script>/gi,m=/src=["']([^"']+)["']/i;for(;null!==(t=w.exec(u));){let e=t[0],r=t[1]?.trim(),a=e.match(m),o=a?a[1]:null,n=h.find(({pattern:e})=>!!(o&&e.test(o)||r&&e.test(r)));n&&f.push({fullTag:e,src:o,content:r,type:e.match(/type=["']([^"']+)["']/i)?.[1]||null,async:e.includes("async"),defer:e.includes("defer"),crossorigin:e.match(/crossorigin=["']([^"']+)["']/i)?.[1]||null,category:n.category})}console.log("Found analytics scripts in header:",f.length),f.forEach(e=>{console.log("Analytics Script:",{fullTag:e.fullTag,category:e.category,src:e.src,type:e.type,async:e.async,defer:e.defer})});let A={analyticsScripts:f,totalScripts:f.length,totalAnalyticsScripts:f.length};return d(c.NextResponse.json({success:!0,data:A}))}catch(e){return console.error("Error fetching analytics scripts:",e),d(c.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to fetch analytics scripts"},{status:500}))}}let y=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"D:\\cloudBackend\\search-server\\app\\api\\analytics\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:u,workUnitAsyncStorage:h,serverHooks:f}=y;function w(){return(0,s.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:h})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[297,190,595],()=>r(62008));module.exports=a})();