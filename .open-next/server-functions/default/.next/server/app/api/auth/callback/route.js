(()=>{var e={};e.id=442,e.ids=[442],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6426:(e,t,r)=>{"use strict";r.d(t,{DM:()=>s});let n=Symbol.for("__cloudflare-context__");function s(e={async:!1}){return e.async?a():function(){let e=o();if(e)return e;if(function(){let e=globalThis;return e.__NEXT_DATA__?.nextExport===!0}())throw Error("\n\nERROR: `getCloudflareContext` has been called in sync mode in either a static route or at the top level of a non-static one, both cases are not allowed but can be solved by either:\n  - make sure that the call is not at the top level and that the route is not static\n  - call `getCloudflareContext({async: true})` to use the `async` mode\n  - avoid calling `getCloudflareContext` in the route\n");throw Error(l)}()}function o(){return globalThis[n]}async function a(){let e=o();if(e)return e;{let e=await i();return function(e){globalThis[n]=e}(e),e}}async function i(){let{getPlatformProxy:e}=await import(`${"__wrangler".replaceAll("_","")}`),{env:t,cf:r,ctx:n}=await e({environment:process.env.NEXT_DEV_WRANGLER_ENV});return{env:t,cf:r,ctx:n}}let l='\n\nERROR: `getCloudflareContext` has been called without having called `initOpenNextCloudflareForDev` from the Next.js config file.\nYou should update your Next.js config file as shown below:\n\n   ```\n   // next.config.mjs\n\n   import { initOpenNextCloudflareForDev } from "@opennextjs/cloudflare";\n\n   initOpenNextCloudflareForDev();\n\n'+"   const nextConfig = { ... };\n   export default nextConfig;\n   ```\n\n"},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30687:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>c});var s=r(96559),o=r(48088),a=r(37719),i=r(22563),l=r(32190),u=r(6426);async function c(e){let{env:t}=await (0,u.DM)({async:!0}),r=e.nextUrl.searchParams,n=r.get("code");if(!n)return l.NextResponse.json({error:"No code provided"},{status:400});try{if(!t.WEBFLOW_AUTHENTICATION)throw Error("KV namespace 'WEBFLOW_AUTHENTICATION' is missing.");let e=await i.WebflowClient.getAccessToken({clientId:process.env.CLIENT_ID,clientSecret:process.env.CLIENT_SECRET,code:n}),s=new i.WebflowClient({accessToken:e}),o=await s.sites.list(),a=await s.token.introspect(),u=o?.sites??[];if(0===u.length)return l.NextResponse.json({error:"No Webflow sites found."},{status:400});if(await Promise.all(u.map(async r=>{await t.WEBFLOW_AUTHENTICATION.put(r.id,JSON.stringify({accessToken:e,siteName:r.shortName}),{expirationTtl:86400}),await t.WEBFLOW_AUTHENTICATION.put(`site-name:${r.shortName}`,r.id,{expirationTtl:86400})})),"webflow_designer"===r.get("state"))return new l.NextResponse(`<!DOCTYPE html>
        <html>
          <head><title>Authorization Complete</title></head>
          <body>
            <script>
              window.opener.postMessage('authComplete', '*');
              window.close();
            </script>
          </body>
        </html>`,{headers:{"Content-Type":"text/html"}});{let e=a?.authorization?.authorizedTo?.workspaceIds??[];if(e.length>0)return l.NextResponse.redirect(new URL(`https://webflow.com/dashboard?workspace=${e[0]}`));let t=u[0];if(t)return l.NextResponse.redirect(new URL(`https://${t.shortName}.design.webflow.com?app=${process.env.CLIENT_ID}`))}}catch(e){return console.error("Error during OAuth callback:",e),l.NextResponse.json({error:"Failed to process authorization",details:e instanceof Error?e.message:String(e),envCheck:{hasClientId:!!process.env.CLIENT_ID,hasClientSecret:!!process.env.CLIENT_SECRET,hasKV:!!t.WEBFLOW_AUTHENTICATION}},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/callback/route",pathname:"/api/auth/callback",filename:"route",bundlePath:"app/api/auth/callback/route"},resolvedPagePath:"D:\\cloudBackend\\search-server\\app\\api\\auth\\callback\\route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:h,serverHooks:f}=p;function x(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:h})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[297,190,563],()=>r(30687));module.exports=n})();