(()=>{var e={};e.id=464,e.ids=[464],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},42281:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>N,routeModule:()=>g,serverHooks:()=>A,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{OPTIONS:()=>d,POST:()=>T});var n=r(96559),o=r(48088),i=r(37719),a=r(32190),u=r(87806),l=r(97130),c=r(6426);function p(e,t){return t&&(e.headers.set("Access-Control-Allow-Origin",t),e.headers.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization")),e}async function d(e){let t=e.headers.get("origin");return p(new a.NextResponse(null,{status:204}),t)}async function T(e){let t=e.headers.get("origin");try{let{visitorId:r,userAgent:s,siteName:n}=await e.json();if(console.log(" visitor-token",r,s,n),!r||!n)return p(a.NextResponse.json({error:"Visitor ID and site name are required"},{status:400}),t);let o=await (0,l.A)(n);if(!o)return p(a.NextResponse.json({error:"Site not found"},{status:404}),t);let i=await new u.P({visitorId:r,userAgent:s,siteName:n,timestamp:Date.now()}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(new TextEncoder().encode(o.accessToken)),{env:d}=await (0,c.DM)();if(!d?.WEBFLOW_AUTHENTICATION)return p(a.NextResponse.json({error:"KV binding missing"},{status:500}),t);let T=`visitor-token:${n}`;return await d.WEBFLOW_AUTHENTICATION.put(T,i,{expirationTtl:86400}),p(a.NextResponse.json({token:i,visitorId:r}),t)}catch(e){return console.error("Error generating visitor token:",e),p(a.NextResponse.json({error:"Internal server error"},{status:500}),t)}}let g=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/visitor-token/route",pathname:"/api/visitor-token",filename:"route",bundlePath:"app/api/visitor-token/route"},resolvedPagePath:"D:\\SearchApp\\search-server\\app\\api\\visitor-token\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:x,serverHooks:A}=g;function N(){return(0,i.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:x})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{},97130:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(6426);async function n(e){try{console.log("sitenme:",e);let{env:t}=await (0,s.DM)({async:!0});if(!t?.WEBFLOW_AUTHENTICATION)return console.error("KV binding WEBFLOW_AUTHENTICATION missing in findSiteDetails"),null;let r=`site-name:${e}`,n=await t.WEBFLOW_AUTHENTICATION.get(r);if(n){let s=await t.WEBFLOW_AUTHENTICATION.get(n);if(s)try{let t=JSON.parse(s);if(t.siteName===e||t.fullDomainName===e)return{...t,siteId:n}}catch(e){return console.error(`Failed to parse SiteDetails JSON for siteId '${n}' (obtained from key '${r}'). Value: ${s}`,e),null}}return console.warn(`findSiteDetails: No site found for siteNameInput '${e}' using direct lookup.`),null}catch(t){return console.error("Error in findSiteDetails for input ",e,t),null}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[297,190,595],()=>r(42281));module.exports=s})();