(()=>{var e={};e.id=656,e.ids=[656],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},35985:(e,t,r)=>{"use strict";function o(e){return(console.log("Selecting banner for:",e),["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LT","LU","LV","MT","NL","PL","PT","RO","SK","SI","ES","SE"].includes(e))?"GDPR":"US"===e?"CCPA":"GDPR"}r.d(t,{A:()=>o})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46509:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var o=r(87806),s=r(77412),n=r(6426);let a={createSessionToken:async e=>{let t=new TextEncoder().encode(process.env.CLIENT_SECRET),r=await new o.P({user:e}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(t),n=await (0,s.V)(r,t);return console.log("____inside create session_____ ",r),{sessionToken:r,exp:n.payload.exp}},verifyAuth:async e=>{let t=e.headers.get("authorization"),r=t?.split(" ")[1];if(console.log("inside verify auth session",r),!r)return null;try{let e=new TextEncoder().encode(process.env.WEBFLOW_CLIENT_SECRET),{payload:t}=await (0,s.V)(r,e),o=t.user.id,{env:a}=await (0,n.DM)({async:!0}),i=await a.WEBFLOW_AUTHENTICATION.get(`user-auth:${o}`);if(i){let e=JSON.parse(i);return console.log("inside verify auth access token",e.accessToken),e.accessToken}return null}catch{return null}},getAccessToken:async e=>{try{let t=null;if("POST"===e.method?(t=(await e.json()).siteId,console.log("siteId",t)):"GET"===e.method&&(t=e.nextUrl.searchParams.get("siteId"),console.log("siteId in params",t)),!t)return console.error("No siteId provided in request."),null;let{env:r}=await (0,n.DM)({async:!0}),o=await r.WEBFLOW_AUTHENTICATION.get(t);if(console.log("stored info in kv",o),o)return JSON.parse(o).accessToken;return console.error(`No access token found for site ${t}`),null}catch(e){return console.error("Error getting access token:",e),null}},getSiteIdFromAccessToken:async e=>{try{let{env:t}=await (0,n.DM)({async:!0});for(let r of(await t.WEBFLOW_AUTHENTICATION.list()).keys){let o=await t.WEBFLOW_AUTHENTICATION.get(r.name);if(o&&JSON.parse(o).accessToken===e)return String(r.name)}return null}catch(e){return console.error("Error getting site ID:",e),null}}}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},87728:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>T,serverHooks:()=>h,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>A});var o={};r.r(o),r.d(o,{OPTIONS:()=>d,POST:()=>p});var s=r(96559),n=r(48088),a=r(37719),i=r(32190),c=r(35985),l=r(46509);function u(e){return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),e}async function d(){return u(new i.NextResponse(null,{status:204}))}async function p(e){try{let t=e.clone(),r=await t.json();console.log("Detect Location Request body:",r);let o=await l.A.verifyAuth(e);if(!o)return console.error("Authentication failed:",o),u(i.NextResponse.json({error:"Unauthorized",details:o||"Authentication failed"},{status:401}));let s=await l.A.getSiteIdFromAccessToken(o);if(!s)return console.error("SiteId not found:",s),u(i.NextResponse.json({error:"Unauthorized",details:s||"SiteId failed"},{status:401}));console.log("Request Headers:",[...e.headers]);let n=e.headers.get("CF-IPCountry")||"UNKNOWN",a=e.headers.get("CF-IPContinent")||"UNKNOWN";console.log("Detected location:",{country:n,continent:a});let d=(0,c.A)(n);return u(i.NextResponse.json({currentBannerType:d},{status:200}))}catch(e){if(e instanceof Error)return console.error("Error applying custom code:",e.message),u(i.NextResponse.json({error:"Failed to apply custom code",details:e.message},{status:500}));return console.error("Unknown error:",e),u(i.NextResponse.json({error:"Failed to apply custom code",details:"An unknown error occurred"},{status:500}))}}let T=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/cmp/detect-location/route",pathname:"/api/cmp/detect-location",filename:"route",bundlePath:"app/api/cmp/detect-location/route"},resolvedPagePath:"C:\\Seattle\\Cookie App\\Consernbit-Cloudflare-Server-Test\\cb-server\\app\\api\\cmp\\detect-location\\route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:g,workUnitAsyncStorage:A,serverHooks:h}=T;function f(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:A})}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[297,190,682],()=>r(87728));module.exports=o})();