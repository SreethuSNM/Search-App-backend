exports.id=112,exports.ids=[112],exports.modules={46509:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(87806),o=r(77412),a=r(6426);let i={createSessionToken:async e=>{let t=new TextEncoder().encode(process.env.CLIENT_SECRET),r=await new s.P({user:e}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(t),a=await (0,o.V)(r,t);return console.log("____inside create session_____ ",r),{sessionToken:r,exp:a.payload.exp}},verifyAuth:async e=>{let t=e.headers.get("authorization");console.log("authheader",t);let r=t?.split(" ")[1];if(console.log("session token",r),console.log("inside verify auth session",r),!r)return null;try{let e=new TextEncoder().encode(process.env.CLIENT_SECRET),{payload:t}=await (0,o.V)(r,e),s=t.user.id,{env:i}=await (0,a.DM)({async:!0}),n=await i.WEBFLOW_AUTHENTICATION.get(`user-auth:${s}`);if(n){let e=JSON.parse(n);return console.log("inside verify auth access token",e.accessToken),e.accessToken}return null}catch{return null}},getAccessToken:async e=>{try{let t=null;if("POST"===e.method?(t=(await e.json()).siteId,console.log("siteId",t)):"GET"===e.method&&(t=e.nextUrl.searchParams.get("siteId"),console.log("siteId in params",t)),!t)return console.error("No siteId provided in request."),null;let{env:r}=await (0,a.DM)({async:!0}),s=await r.WEBFLOW_AUTHENTICATION.get(t);if(console.log("stored info in kv",s),s)return JSON.parse(s).accessToken;return console.error(`No access token found for site ${t}`),null}catch(e){return console.error("Error getting access token:",e),null}},getSiteIdFromAccessToken:async e=>{try{let{env:t}=await (0,a.DM)({async:!0});for(let r of(await t.WEBFLOW_AUTHENTICATION.list()).keys){let s=await t.WEBFLOW_AUTHENTICATION.get(r.name);if(s&&JSON.parse(s).accessToken===e)return String(r.name)}return null}catch(e){return console.error("Error getting site ID:",e),null}}}},73488:(e,t,r)=>{"use strict";r.d(t,{Y:()=>c});class s{constructor(){this.CACHE_DURATION=3e5,this.cache=new Map}static getInstance(){return s.instance||(s.instance=new s),s.instance}get(e){let t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.CACHE_DURATION?t.data:null}set(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clear(){this.cache.clear()}}class o{constructor(){this.BATCH_SIZE=3,this.DELAY_BETWEEN_BATCHES=1e3}static getInstance(){return o.instance||(o.instance=new o),o.instance}async processBatch(e,t){let r=new Map;for(let s=0;s<e.length;s+=this.BATCH_SIZE){let o=e.slice(s,s+this.BATCH_SIZE);await Promise.all(o.map(async e=>{try{let s=await t(e);r.set(e,s)}catch(t){console.error(`Error processing item ${e}:`,t),r.set(e,{})}})),s+this.BATCH_SIZE<e.length&&await new Promise(e=>setTimeout(e,this.DELAY_BETWEEN_BATCHES))}return r}}var a=r(55511),i=r.n(a);function n(e){return"object"==typeof e&&null!==e&&"statusCode"in e}class c{constructor(e){this.webflow=e,this.cache=s.getInstance(),this.rateLimiter=o.getInstance()}updateWebflowClient(e){this.webflow=e}async getRegisteredScripts(e){try{return(await this.webflow.scripts.list(e)).registeredScripts}catch(e){throw console.error("Error fetching scripts:",e),e}}async registerInlineScript(e,t){try{let r={sourceCode:t.sourceCode,canCopy:t.canCopy??!0,version:t.version,displayName:t.displayName};return await this.webflow.scripts.registerInline(e,r)}catch(e){throw console.error("Error registering inline script:",e),e}}async registerHostedScripts(e){try{console.log("Siteid in hosted script",e);let t="https://cdn.jsdelivr.net/gh/reshmalb17/cmp_script@2a31a60/New_Script.js",r=await this.generateSRI(t),s={hostedLocation:t,integrityHash:r,canCopy:!0,version:"1.0.0",displayName:`ConsentScript2025${Date.now()}`};return console.log("scriptData",s),await this.webflow.scripts.registerHosted(e,s)}catch(e){throw console.error("Error registering hosted script:",e),e}}async getSiteCustomCode(e){console.log("Using Access Token inside getSiteCustomCode:",this.webflow);let t=`site_${e}`;console.log(t);let r=this.cache.get(t);if(console.log(r),r)return r;try{console.log("inside try");let r=await this.webflow.sites.scripts.getCustomCode(e);return console.log("this is the result",r),this.cache.set(t,r),r}catch(e){throw console.error("Error fetching site custom code:",e),e}}async upsertSiteCustomCode(e,t,r,s){try{let o=await this.getExistingScripts("site",e);return console.log("[DEBUG] upsertSiteCustomCode existing scripts:",o),o=o.filter(e=>e.id!==t),console.log("[DEBUG] upsertSiteCustomCode after filter:",o),o.push({id:t,location:r,version:s}),console.log("[DEBUG] upsertSiteCustomCode final scripts array:",o),await this.webflow.sites.scripts.upsertCustomCode(e,{scripts:o})}catch(e){throw console.error("Error upserting site custom code:",e),e}}async deleteSiteCustomCode(e){try{let t=await this.webflow.sites.scripts.deleteCustomCode(e);return this.cache.set(`site_${e}`,null),t}catch(e){throw console.error("Error deleting site custom code:",e),e}}async getPageCustomCode(e){let t=`page_${e}`,r=this.cache.get(t);if(r)return r;try{let r=(await this.webflow.pages.scripts.getCustomCode(e)).scripts||[];return this.cache.set(t,r),r}catch(e){if(n(e)&&404!==e.statusCode)throw e;return[]}}async getMultiplePageCustomCode(e){let t=new Map,r=[];for(let s of e){let e=`page_${s}`,o=this.cache.get(e);o?t.set(s,o):r.push(s)}if(r.length>0)for(let[e,s]of(await this.rateLimiter.processBatch(r,async e=>{try{let t=(await this.webflow.pages.scripts.getCustomCode(e)).scripts||[];return this.cache.set(`page_${e}`,t),t}catch(e){if(n(e)&&404!==e.statusCode)throw e;return[]}})))t.set(e,s);return t}async upsertPageCustomCode(e,t,r,s){try{let o=await this.getExistingScripts("page",e);return(o=o.filter(e=>e.id!==t)).push({id:t,location:r,version:s}),await this.webflow.pages.scripts.upsertCustomCode(e,{scripts:o})}catch(e){throw console.error("Error upserting page custom code:",e),e}}async deletePageCustomCode(e){try{let t=await this.webflow.pages.scripts.deleteCustomCode(e);return this.cache.set(`page_${e}`,null),t}catch(e){throw console.error("Error deleting page custom code:",e),e}}async generateSRI(e){let t=await fetch(e),r=await t.text(),s=i().createHash("sha384").update(r).digest("base64");return`sha384-${s}`}async getExistingScripts(e,t){try{let r="site"===e?this.getSiteCustomCode:this.getPageCustomCode,s=await r.call(this,t);console.log(`[DEBUG] getExistingScripts raw response for ${e}:`,s);let o="site"===e?s.scripts||[]:s||[];return console.log(`[DEBUG] getExistingScripts processed scripts for ${e}:`,o),o}catch(t){if(console.error(`[DEBUG] getExistingScripts error for ${e}:`,t),n(t)&&404!==t.statusCode)throw t;return[]}}}},77412:(e,t,r)=>{"use strict";r.d(t,{V:()=>H});var s=r(21187),o=r(16263),a=r(92120),i=r(4208);let n=async(e,t,r,s)=>{let n=await (0,i.A)(e,t,"verify");(0,a.A)(e,n);let c=(0,o.A)(e,n.algorithm);try{return await crypto.subtle.verify(c,n,r,s)}catch{return!1}};var c=r(70803),d=r(97989),l=r(74996),h=r(89531),p=r(44032),u=r(41286);let w=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};var g=r(95548);async function y(e,t,r){let o,a;if(!(0,h.A)(e))throw new c.Ye("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new c.Ye('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new c.Ye("JWS Protected Header incorrect type");if(void 0===e.payload)throw new c.Ye("JWS Payload missing");if("string"!=typeof e.signature)throw new c.Ye("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,h.A)(e.header))throw new c.Ye("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=(0,s.D)(e.protected);i=JSON.parse(d.D0.decode(t))}catch{throw new c.Ye("JWS Protected Header is invalid")}if(!(0,l.A)(i,e.header))throw new c.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let y={...i,...e.header},f=(0,u.A)(c.Ye,new Map([["b64",!0]]),r?.crit,i,y),m=!0;if(f.has("b64")&&"boolean"!=typeof(m=i.b64))throw new c.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:H}=y;if("string"!=typeof H||!H)throw new c.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');let C=r&&w("algorithms",r.algorithms);if(C&&!C.has(H))throw new c.Rb('"alg" (Algorithm) Header Parameter value not allowed');if(m){if("string"!=typeof e.payload)throw new c.Ye("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new c.Ye("JWS Payload must be a string or an Uint8Array instance");let S=!1;"function"==typeof t&&(t=await t(i,e),S=!0),(0,p.A)(H,t,"verify");let E=(0,d.xW)(d.Rd.encode(e.protected??""),d.Rd.encode("."),"string"==typeof e.payload?d.Rd.encode(e.payload):e.payload);try{o=(0,s.D)(e.signature)}catch{throw new c.Ye("Failed to base64url decode the signature")}let b=await (0,g.A)(t,H);if(!await n(H,b,o,E))throw new c.h2;if(m)try{a=(0,s.D)(e.payload)}catch{throw new c.Ye("Failed to base64url decode the payload")}else a="string"==typeof e.payload?d.Rd.encode(e.payload):e.payload;let A={payload:a};return(void 0!==e.protected&&(A.protectedHeader=i),void 0!==e.header&&(A.unprotectedHeader=e.header),S)?{...A,key:b}:A}async function f(e,t,r){if(e instanceof Uint8Array&&(e=d.D0.decode(e)),"string"!=typeof e)throw new c.Ye("Compact JWS must be a string or Uint8Array");let{0:s,1:o,2:a,length:i}=e.split(".");if(3!==i)throw new c.Ye("Invalid Compact JWS");let n=await y({payload:o,protected:s,signature:a},t,r),l={payload:n.payload,protectedHeader:n.protectedHeader};return"function"==typeof t?{...l,key:n.key}:l}var m=r(91492);async function H(e,t,r){let s=await f(e,t,r);if(s.protectedHeader.crit?.includes("b64")&&!1===s.protectedHeader.b64)throw new c.Dp("JWTs MUST NOT use unencoded payload");let o={payload:(0,m.k)(s.protectedHeader,s.payload,r),protectedHeader:s.protectedHeader};return"function"==typeof t?{...o,key:s.key}:o}},78335:()=>{},87806:(e,t,r)=>{"use strict";r.d(t,{P:()=>f});var s=r(21187),o=r(16263),a=r(92120),i=r(4208);let n=async(e,t,r)=>{let s=await (0,i.A)(e,t,"sign");return(0,a.A)(e,s),new Uint8Array(await crypto.subtle.sign((0,o.A)(e,s.algorithm),s,r))};var c=r(74996),d=r(70803),l=r(97989),h=r(44032),p=r(41286),u=r(95548);class w{#e;#t;#r;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#e=e}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setUnprotectedHeader(e){if(this.#r)throw TypeError("setUnprotectedHeader can only be called once");return this.#r=e,this}async sign(e,t){let r;if(!this.#t&&!this.#r)throw new d.Ye("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,c.A)(this.#t,this.#r))throw new d.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o={...this.#t,...this.#r},a=(0,p.A)(d.Ye,new Map([["b64",!0]]),t?.crit,this.#t,o),i=!0;if(a.has("b64")&&"boolean"!=typeof(i=this.#t.b64))throw new d.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:w}=o;if("string"!=typeof w||!w)throw new d.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,h.A)(w,e,"sign");let g=this.#e;i&&(g=l.Rd.encode((0,s.l)(g))),r=this.#t?l.Rd.encode((0,s.l)(JSON.stringify(this.#t))):l.Rd.encode("");let y=(0,l.xW)(r,l.Rd.encode("."),g),f=await (0,u.A)(e,w),m=await n(w,f,y),H={signature:(0,s.l)(m),payload:""};return i&&(H.payload=l.D0.decode(g)),this.#r&&(H.header=this.#r),this.#t&&(H.protected=l.D0.decode(r)),H}}class g{#s;constructor(e){this.#s=new w(e)}setProtectedHeader(e){return this.#s.setProtectedHeader(e),this}async sign(e,t){let r=await this.#s.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}var y=r(91492);class f{#t;#o;constructor(e={}){this.#o=new y.c(e)}setIssuer(e){return this.#o.iss=e,this}setSubject(e){return this.#o.sub=e,this}setAudience(e){return this.#o.aud=e,this}setJti(e){return this.#o.jti=e,this}setNotBefore(e){return this.#o.nbf=e,this}setExpirationTime(e){return this.#o.exp=e,this}setIssuedAt(e){return this.#o.iat=e,this}setProtectedHeader(e){return this.#t=e,this}async sign(e,t){let r=new g(this.#o.data());if(r.setProtectedHeader(this.#t),Array.isArray(this.#t?.crit)&&this.#t.crit.includes("b64")&&!1===this.#t.b64)throw new d.Dp("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}},96487:()=>{}};